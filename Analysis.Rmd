---
title: "予測モデリングプロジェクト"
author: "Shinya Hashimoto"
date: "2024-02-23"
output: html_document
---

## 概要

本プロジェクトでは、ウェアラブルデバイスから収集された加速度計のデータを使用して、運動実行の質を予測します。分析の目的は、演習の実行方法（`classe`変数）を予測することです。

## データの読み込みと前処理

```{r, cache=TRUE}
library(caret)
library(ggplot2)
library(rpart.plot)
library(corrplot)
set.seed(12345)

# データのダウンロード
trainingUrl <- "https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv"
testingUrl <- "https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv"
training <- read.csv(url(trainingUrl), na.strings=c("NA","#DIV/0!", ""))
testing <- read.csv(url(testingUrl), na.strings=c("NA","#DIV/0!", ""))
```

## データクリーニングと前処理

```{r, cache=TRUE}
# NA値を含む列を削除
training <- training[, colSums(is.na(training)) == 0]
testing <- testing[, colSums(is.na(testing)) == 0]

# 最初の7列を削除
training <- training[, -c(1:7)]
testing <- testing[, -c(1:7)]
```

## モデルの構築と評価

```{r, cache=TRUE}
subSamples <- createDataPartition(y=training$classe, p=0.75, list=FALSE)
subTraining <- training[subSamples,]
subTesting <- training[-subSamples,]

# トレーニングのコントロール設定
control <- trainControl(method="cv", number=3, verboseIter=TRUE)

# トレーニングのコントロール設定
control <- trainControl(method="cv", number=3, verboseIter=TRUE)

# 各モデルの構築と評価
models <- list("rpart", "rf", "gbm", "svmLinear")
names(models) <- c("Decision Tree", "Random Forest", "Gradient Boosted Trees", "SVM")

results <- lapply(models, function(method) {
  # モデルの構築
  model <- train(classe ~ ., data=subTraining, method=method, trControl=control, tuneLength=1)
  # テストデータに対する予測
  prediction <- predict(model, subTesting)
  # 予測の精度評価
  cm <- confusionMatrix(prediction, factor(subTesting$classe))
  # 結果の表示
  #results_df <- sapply(results, function(x) x$overall['Accuracy'])
  #data.frame(Model=names(models), Accuracy=unlist(results_df), row.names=NULL)
  return(model)
})

```

## テストセットでの予測

```{r, cache=TRUE}
# Random Forestモデルを使用してテストセットの予測を行う
best_model <- results[["Random Forest"]][["model"]]
pred <- predict(best_model, subTraining)
print(pred)
#best_model
```
